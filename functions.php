<?php		function selLang($la='en'){		global $dbPdo;		$sql = "SELECT * FROM lang WHERE lang='$la'";		$curlang = $dbPdo->query($sql);		$lang = $curlang->fetch(PDO::FETCH_ASSOC);		$_SESSION['lang'] = $la;		return $lang;	}	function clearData($data){		return  htmlspecialchars(addslashes(trim(strip_tags(($data)))));	}		function fetchToArrPDO($sel){		global $dbPdo;		while($ar = $sel->fetch(PDO::FETCH_ASSOC)){			$arr[] = $ar;		}		if (!empty($arr))			return $arr;	} 	function fetchToArr($sel){		while($ar = mysql_fetch_array($sel)){			$arr[] = $ar;		}		if (!empty($arr))			return $arr;	}	function aunt($login,$pass){		$sql = "SELECT pass, status FROM users WHERE login='$login'";		global $dbPdo;		$user = $dbPdo->query($sql);		$dbpass = $user->fetch(PDO::FETCH_ASSOC);		if(empty($dbpass)){			global $lang;			$_SESSION['error'] = $lang['invalidpass'];			header("Location: index.php");			exit;		}		if($dbpass['pass'] == md5($pass)){			$_SESSION['name'] = $login;			$_SESSION['status'] = $dbpass['status'];			unset($_SESSION['error']);			setlogined();			header("Location: index.php");		}else{			global $lang;			$_SESSION['error'] = $lang['invalidpass'];			header("Location: index.php");			exit;		}	}	function reg($login, $pass, $email=''){		global $dbPdo;		$sql = "SELECT login FROM users WHERE login='$login'";		$user = $dbPdo->query($sql);		$dbpass = $user->fetch(PDO::FETCH_ASSOC);		if(!empty($dbpass)){			global $lang;			$_SESSION['error'] = $lang['dublicate'];			header("Location: index.php?reg");			exit;		}else{			$pass = md5($pass);			$sql = "INSERT INTO users (login, pass, email, status) VALUES ('$login','$pass','$email', '1')";			$act = $dbPdo->exec($sql);			if($act){				$_SESSION['name'] = $login;				$_SESSION['status'] = 1;				setregistered();			}		}		header("Location: index.php");	}	function profile($login, $fname='',$lname='', $email=''){		print_R($_FILES);		global $dbPdo;		$tmp = $_FILES['img']['tmp_name'];		//$filename = $_FILES['img']['name'];		$saved = "files/".$login;		move_uploaded_file($tmp, $saved);		$sql = "UPDATE users SET fname='$fname', lname='$lname', email='$email', img='$login' WHERE login='$login'";		$dbPdo->exec($sql);		header("Location: index.php?profile=$login");	}	function setlogined(){		global $dbPdo;		$t = time();		$l = $_SESSION['name'];		$sql = "UPDATE users SET logined='$t' WHERE login='$l'";		$dbPdo->exec($sql);	}	function setregistered(){		global $dbPdo;		$t = time();		$l = $_SESSION['name'];		$sql = "UPDATE users SET registered='$t' WHERE login='$l'";		$dbPdo->exec($sql);	}	function getlogined(){		global $dbPdo;		$l = $_SESSION['name'];		$sql = "SELECT logined FROM users WHERE login='$l'";		$log = $dbPdo->query($sql);		return $log->fetchColumn(0);	}	function getregistered(){		global $dbPdo;		$l = $_SESSION['name'];		$sql = "SELECT registered FROM users WHERE login='$l'";		$log = $dbPdo->query($sql);		return $log->fetchColumn(0);	}	function countUser(){		global $dbPdo;		$sql = "SELECT COUNT(*) FROM users";		$count = $dbPdo->query($sql);		return  $count->fetchColumn();	}	function getMenu($status = 0){		$sql = "SELECT COUNT(*) FROM users";		$res = mysql_query($sql) or die(mysql_error());		$row = mysql_fetch_row($res);		if($row){			$sql = "SELECT * FROM menu";			$menu = mysql_query($sql) or die(mysql_error());			$m = fetchToArr($menu);			return $m;		}			}	function getText($id){		global $dbPdo;		$sql = "SELECT text FROM menu WHERE id=$id";		$text = $dbPdo->query($sql);		return $text->fetchColumn(0);	}	function getTexten($id){		global $dbPdo;		$sql = "SELECT texten FROM menu WHERE id=$id";		$text = $dbPdo->query($sql);		return $text->fetchColumn(0);;	}	function delList(){		global $dbPdo;		$sql = "SELECT id, title, titleen FROM menu";		$delList = $dbPdo->query($sql);		return fetchToArrPDO($delList);	}	function vievListen($id){		global $dbPdo;		$sql = "SELECT titleen FROM menu WHERE id='$id'";		$delList = $dbPdo->query($sql);		return $delList->fetchColumn(0);	}	function vievList($id){		global $dbPdo;		$sql = "SELECT title FROM menu WHERE id='$id'";		$delList = $dbPdo->query($sql);		return $delList->fetchColumn(0);	}	function add($title,$text,$titleen,$texten){		global $dbPdo;		$sql = "INSERT INTO menu (title, text, titleen, texten) VALUES ('$title', '$text','$titleen', '$texten')";		$addstatus = $dbPdo->exec($sql);		if ($addstatus) 			$_SESSION['addstatus'] = "Страница добавлена";		else			$_SESSION['addstatus'] = "Страница не добавлена";		header("Location: index.php?add");	}	function update($id,$title,$text,$titleen,$texten){		global $dbPdo;		$sql = "UPDATE menu set title='$title', text='$text', titleen='$titleen', texten='$texten' WHERE id='$id'";		$upstatus = $dbPdo->exec($sql);		if($upstatus)			header("Location: index.php?edit=$id");	}		function delMenu($id){		global $dbPdo;		$sql = "DELETE FROM menu WHERE id=$id";		$dbPdo->exec($sql);	}	function getUser(){		global $dbPdo;		$sql = "SELECT login, status FROM users";		$users = $dbPdo->query($sql);		$getusers = fetchToArrPDO($users);		return $getusers;	}	function getProfile($login){		global $dbPdo;		$sql = "SELECT * FROM users WHERE login='$login'";		$users = $dbPdo->query($sql);		$getusers = fetchToArrPDO($users);		return $getusers;	}	function delProfile($name){		global $dbPdo;		$sql = "DELETE FROM users WHERE login='$name'";		$dbPdo->exec($sql);		if($_SESSION['status'] == 3)			header("location: index.php?role");		else			header("location: index.php");	}	function getName($id){		global $dbPdo;		$sql = "SELECT login FROM users WHERE id='$id'";		$user = $dbPdo->query($sql);		return $user->fetchColumn(0);	}	function role($user,$role){		global $dbPdo;		$sql = "SELECT status FROM users WHERE login='$user'";		$sqlstatus = $dbPdo->query($sql);		$status = $sqlstatus->fetch(PDO::FETCH_ASSOC);		if ($role != $status){			$sql = "UPDATE users SET status='$role' WHERE login='$user'";			$dbPdo->exec($sql);		}		header("Location: index.php?role");	}	function setComment($id_articles,$title_comment,$text_comment,$id_user_of_comment,$date_of_public){		global $dbPdo;		$sql =  "INSERT INTO comment 				(id_articles,title_comment,text_comment,id_user_of_comment,date_of_public)				VALUES				('$id_articles','$title_comment','$text_comment','$id_user_of_comment','$date_of_public')";		$dbPdo->exec($sql);		header("location: index.php?id=$id_articles");	}	function getComment($id_articles){		global $dbPdo;		$sql = "SELECT * FROM comment WHERE id_articles='$id_articles' ORDER BY date_of_public DESC";		$comments = $dbPdo->query($sql);		return fetchToArrPDO($comments);	}	function delComment($id){		global $dbPdo;		$sql = "DELETE FROM comment WHERE id='$id'";		$dbPdo->exec($sql);		header("location: $_SERVER[HTTP_REFERER]");	}	function setRating($id_articles,$id_user,$user_rating){		global $dbPdo;		$sql = "INSERT INTO rating_articles (id_articles,id_user,user_rating)		VALUES		($id_articles,$id_user,$user_rating)";		$dbPdo->exec($sql);		header("location: $_SERVER[HTTP_REFERER]");	}	function getAllRating($id_articles){		global $dbPdo;		$sql = "SELECT user_rating FROM rating_articles WHERE id_articles='$id_articles'";		$rating = $dbPdo->query($sql);		$count = 0;		$sum = 0;		while ($r = $rating->fetch(PDO::FETCH_ASSOC)){			$sum += $r['user_rating'];			$count++;		}		if($count == 0)			$count = 1;		return $sum / $count;	}	function getCountRating($id_articles){		global $dbPdo;		$sql = "SELECT id FROM rating_articles WHERE id_articles='$id_articles'";		$result = $dbPdo->query($sql);		$count = 0;		while ($result->fetch(PDO::FETCH_ASSOC)){			$count++;		}		return  $count;	}	function getUserRating($id_user,$id_articles){		global $dbPdo;		$sql = "SELECT user_rating FROM rating_articles WHERE id_user='$id_user' AND id_articles='$id_articles'";		$rating = $dbPdo->query($sql);		return $rating->fetch(PDO::FETCH_ASSOC);	}	function delUserRating($id_user,$id_articles){		global $dbPdo;		$sql = "DELETE FROM rating_articles WHERE id_user='$id_user' AND id_articles='$id_articles'";		$dbPdo->exec($sql);		header("location: index.php?id=$id_articles");	}	function delAllRating($id_articles){		global $dbPdo;		$sql = "DELETE FROM rating_articles WHERE id_articles='$id_articles'";		$dbPdo->exec($sql);		header("location: index.php?edit=$id_articles");	}?>	